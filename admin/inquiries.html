<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>제품 문의 관리 | 서풍 관리자</title>
    <meta name="robots" content="noindex, nofollow">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/admin.css">
</head>
<body class="admin-page">
    <!-- Admin Sidebar -->
    <aside class="admin-sidebar">
        <div class="admin-sidebar__header">
            <img src="../logo_transparent.png" alt="서풍" class="admin-sidebar__logo">
            <span>서풍 관리자</span>
        </div>

        <nav class="admin-nav">
            <a href="dashboard.html" class="admin-nav__item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7"/>
                    <rect x="14" y="3" width="7" height="7"/>
                    <rect x="14" y="14" width="7" height="7"/>
                    <rect x="3" y="14" width="7" height="7"/>
                </svg>
                <span>대시보드</span>
            </a>
            <a href="inquiries.html" class="admin-nav__item admin-nav__item--active">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                </svg>
                <span>제품 문의</span>
                <span class="admin-nav__badge" id="inquiryBadge">0</span>
            </a>
            <a href="quotes.html" class="admin-nav__item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14 2 14 8 20 8"/>
                </svg>
                <span>견적 요청</span>
                <span class="admin-nav__badge" id="quoteBadge">0</span>
            </a>
            <a href="notices.html" class="admin-nav__item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 17H2a3 3 0 0 0 3-3V9a7 7 0 0 1 14 0v5a3 3 0 0 0 3 3zm-8.27 4a2 2 0 0 1-3.46 0"/>
                </svg>
                <span>공지사항 관리</span>
            </a>

            <div class="admin-nav__divider"></div>

            <a href="account-info.html" class="admin-nav__item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                </svg>
                <span>접속 정보</span>
            </a>
        </nav>

        <div class="admin-sidebar__footer">
            <a href="../index.html" class="admin-sidebar__link">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                    <polyline points="15 3 21 3 21 9"/>
                    <line x1="10" y1="14" x2="21" y2="3"/>
                </svg>
                <span>홈페이지 보기</span>
            </a>
            <button class="admin-sidebar__logout" onclick="logout()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                    <polyline points="16 17 21 12 16 7"/>
                    <line x1="21" y1="12" x2="9" y2="12"/>
                </svg>
                <span>로그아웃</span>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="admin-main">
        <header class="admin-header">
            <div class="admin-header__title">
                <h1>제품 문의 관리</h1>
                <p>고객 문의를 확인하고 처리하세요</p>
            </div>
            <div class="admin-header__user">
                <span id="currentUser">관리자</span>
                <span id="loginTime"></span>
            </div>
        </header>

        <div class="admin-content">
            <!-- 필터 -->
            <div class="admin-card" style="margin-bottom: 1.5rem;">
                <div class="admin-card__content" style="padding: 1rem 1.5rem;">
                    <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                        <select id="statusFilter" class="admin-select" onchange="filterInquiries()">
                            <option value="all">전체 상태</option>
                            <option value="pending">대기</option>
                            <option value="progress">검토중</option>
                            <option value="completed">완료</option>
                        </select>
                        <select id="typeFilter" class="admin-select" onchange="filterInquiries()">
                            <option value="all">전체 유형</option>
                            <option value="product">제품문의</option>
                            <option value="sample">샘플요청</option>
                            <option value="trade">거래조건</option>
                            <option value="other">기타</option>
                        </select>
                        <span style="margin-left: auto; font-size: 0.875rem; color: var(--text-light);">
                            총 <strong id="totalCount">0</strong>건
                        </span>
                    </div>
                </div>
            </div>

            <!-- 문의 목록 -->
            <div class="admin-card">
                <div class="admin-card__content" style="padding: 0;">
                    <table class="admin-table" id="inquiriesTable">
                        <thead>
                            <tr>
                                <th style="width: 50px;">No</th>
                                <th>회사명 / 담당자</th>
                                <th>문의유형</th>
                                <th>제목</th>
                                <th style="width: 100px;">등록일</th>
                                <th style="width: 80px;">상태</th>
                                <th style="width: 100px;">관리</th>
                            </tr>
                        </thead>
                        <tbody id="inquiriesList">
                            <!-- 동적으로 생성 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- 상세보기 모달 -->
    <div id="detailModal" class="admin-modal" style="display: none;">
        <div class="admin-modal__content">
            <div class="admin-modal__header">
                <h3 id="modalTitle">문의 상세</h3>
                <button class="admin-modal__close" onclick="closeModal()">&times;</button>
            </div>
            <div class="admin-modal__body" id="modalBody">
                <!-- 동적으로 생성 -->
            </div>
            <div class="admin-modal__footer">
                <select id="modalStatus" class="admin-select">
                    <option value="pending">대기</option>
                    <option value="progress">검토중</option>
                    <option value="completed">완료</option>
                </select>
                <button class="btn btn--primary" onclick="updateStatus()">상태 변경</button>
                <button class="btn btn--outline" onclick="closeModal()" style="color: var(--text-body);">닫기</button>
            </div>
        </div>
    </div>

    <style>
        .admin-select {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border-light);
            border-radius: 0.375rem;
            font-size: 0.875rem;
            background: #fff;
        }
        .admin-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .admin-modal__content {
            background: #fff;
            border-radius: 0.75rem;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .admin-modal__header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border-light);
        }
        .admin-modal__header h3 {
            font-size: 1.125rem;
            font-weight: 600;
        }
        .admin-modal__close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
        }
        .admin-modal__body {
            padding: 1.5rem;
            overflow-y: auto;
            flex: 1;
        }
        .admin-modal__footer {
            display: flex;
            gap: 0.75rem;
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border-light);
            justify-content: flex-end;
        }
        .detail-row {
            display: flex;
            margin-bottom: 1rem;
            font-size: 0.9375rem;
        }
        .detail-label {
            width: 100px;
            color: var(--text-light);
            flex-shrink: 0;
        }
        .detail-value {
            flex: 1;
            color: var(--text-dark);
        }
        .detail-content {
            background: var(--bg-light);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            white-space: pre-wrap;
            line-height: 1.6;
        }
        .unread-row {
            background: #fef3c7;
        }
        .admin-table tbody tr {
            cursor: pointer;
            transition: background 0.2s;
        }
        .admin-table tbody tr:hover {
            background: var(--bg-light);
        }
    </style>

    <script src="../js/data.js"></script>
    <script>
        let currentInquiryId = null;

        // 로그인 체크
        if (sessionStorage.getItem('adminLoggedIn') !== 'true') {
            window.location.href = 'index.html';
        }

        // 사용자 정보 표시
        document.getElementById('currentUser').textContent = sessionStorage.getItem('adminUser') || '관리자';
        const loginTime = sessionStorage.getItem('loginTime');
        if (loginTime) {
            const date = new Date(loginTime);
            document.getElementById('loginTime').textContent =
                `로그인: ${date.toLocaleDateString('ko-KR')} ${date.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'})}`;
        }

        // 로그아웃
        function logout() {
            sessionStorage.removeItem('adminLoggedIn');
            sessionStorage.removeItem('adminUser');
            sessionStorage.removeItem('loginTime');
            window.location.href = 'index.html';
        }

        // 문의 목록 렌더링
        function renderInquiries() {
            const inquiries = SeopungData.inquiries.getAll();
            const statusFilter = document.getElementById('statusFilter').value;
            const typeFilter = document.getElementById('typeFilter').value;

            let filtered = inquiries;

            if (statusFilter !== 'all') {
                filtered = filtered.filter(i => i.status === statusFilter);
            }
            if (typeFilter !== 'all') {
                filtered = filtered.filter(i => i.inquiry_type === typeFilter);
            }

            document.getElementById('totalCount').textContent = filtered.length;

            const tbody = document.getElementById('inquiriesList');
            tbody.innerHTML = '';

            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 2rem; color: var(--text-light);">문의 내역이 없습니다.</td></tr>';
                return;
            }

            filtered.forEach((inquiry, index) => {
                const tr = document.createElement('tr');
                tr.className = !inquiry.read ? 'unread-row' : '';
                tr.onclick = () => openDetail(inquiry.id);

                tr.innerHTML = `
                    <td>${filtered.length - index}</td>
                    <td>
                        <strong>${inquiry.company}</strong><br>
                        <small>${inquiry.name}</small>
                    </td>
                    <td>${SeopungData.getInquiryTypeText(inquiry.inquiry_type)}</td>
                    <td>${inquiry.title}${!inquiry.read ? ' <span style="color: #ef4444; font-weight: 600;">N</span>' : ''}</td>
                    <td>${SeopungData.formatDate(inquiry.date)}</td>
                    <td><span class="admin-badge ${SeopungData.getStatusClass(inquiry.status)}">${SeopungData.getStatusText(inquiry.status)}</span></td>
                    <td>
                        <button class="btn btn--outline" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;" onclick="event.stopPropagation(); deleteInquiry(${inquiry.id})">삭제</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });

            // 배지 업데이트
            updateBadges();
        }

        // 필터링
        function filterInquiries() {
            renderInquiries();
        }

        // 상세보기 열기
        function openDetail(id) {
            const inquiry = SeopungData.inquiries.getAll().find(i => i.id === id);
            if (!inquiry) return;

            currentInquiryId = id;

            // 읽음 처리
            if (!inquiry.read) {
                SeopungData.inquiries.update(id, { read: true });
                renderInquiries();
            }

            document.getElementById('modalTitle').textContent = inquiry.title;
            document.getElementById('modalStatus').value = inquiry.status;

            document.getElementById('modalBody').innerHTML = `
                <div class="detail-row">
                    <span class="detail-label">회사명</span>
                    <span class="detail-value">${inquiry.company}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">담당자</span>
                    <span class="detail-value">${inquiry.name}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">연락처</span>
                    <span class="detail-value"><a href="tel:${inquiry.phone}">${inquiry.phone}</a></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">이메일</span>
                    <span class="detail-value"><a href="mailto:${inquiry.email}">${inquiry.email}</a></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">문의유형</span>
                    <span class="detail-value">${SeopungData.getInquiryTypeText(inquiry.inquiry_type)}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">등록일</span>
                    <span class="detail-value">${SeopungData.formatDate(inquiry.date)}</span>
                </div>
                <div class="detail-content">${inquiry.content || '내용 없음'}</div>
            `;

            document.getElementById('detailModal').style.display = 'flex';
        }

        // 모달 닫기
        function closeModal() {
            document.getElementById('detailModal').style.display = 'none';
            currentInquiryId = null;
        }

        // 상태 변경
        function updateStatus() {
            if (!currentInquiryId) return;

            const newStatus = document.getElementById('modalStatus').value;
            SeopungData.inquiries.update(currentInquiryId, { status: newStatus });

            alert('상태가 변경되었습니다.');
            closeModal();
            renderInquiries();
        }

        // 삭제
        function deleteInquiry(id) {
            if (confirm('정말 삭제하시겠습니까?')) {
                SeopungData.inquiries.delete(id);
                renderInquiries();
            }
        }

        // 배지 업데이트
        function updateBadges() {
            document.getElementById('inquiryBadge').textContent = SeopungData.inquiries.getUnreadCount();
            document.getElementById('quoteBadge').textContent = SeopungData.quotes.getUnreadCount();
        }

        // 초기화
        renderInquiries();

        // 모달 외부 클릭 시 닫기
        document.getElementById('detailModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });
    </script>
</body>
</html>
