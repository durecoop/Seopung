<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>채용정보 관리 | 서풍 관리자</title>
    <meta name="robots" content="noindex, nofollow">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/admin.css">
    <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css">
</head>
<body class="admin-page">
    <aside class="admin-sidebar">
        <div class="admin-sidebar__header"><img src="../logo_transparent.png" alt="서풍" class="admin-sidebar__logo"><span>서풍 관리자</span></div>
        <nav class="admin-nav">
            <a href="dashboard.html" class="admin-nav__item"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg><span>대시보드</span></a>
            <a href="notices.html" class="admin-nav__item"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 17H2a3 3 0 0 0 3-3V9a7 7 0 0 1 14 0v5a3 3 0 0 0 3 3zm-8.27 4a2 2 0 0 1-3.46 0"/></svg><span>공지사항</span></a>
            <a href="news-manage.html" class="admin-nav__item"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-2 2Zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2"/></svg><span>뉴스/보도자료</span></a>
            <a href="resources-manage.html" class="admin-nav__item"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg><span>자료실</span></a>
            <a href="faq-manage.html" class="admin-nav__item"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg><span>FAQ</span></a>
            <a href="careers-manage.html" class="admin-nav__item admin-nav__item--active"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" y1="8" x2="19" y2="14"/><line x1="22" y1="11" x2="16" y2="11"/></svg><span>채용정보</span></a>
            <a href="inquiries.html" class="admin-nav__item"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg><span>제품 문의</span></a>
            <a href="quotes.html" class="admin-nav__item"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg><span>견적 요청</span></a>
        </nav>
        <div class="admin-sidebar__footer">
            <a href="../index.html" class="admin-sidebar__link"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg><span>홈페이지 보기</span></a>
            <button class="admin-sidebar__logout" onclick="logout()"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg><span>로그아웃</span></button>
        </div>
    </aside>

    <main class="admin-main">
        <header class="admin-header">
            <div class="admin-header__title"><h1>채용정보 관리</h1><p>채용 공고를 관리하세요</p></div>
            <div class="admin-header__user"><span id="currentUser">관리자</span></div>
        </header>

        <div class="admin-content">
            <div class="admin-card" style="margin-bottom: 1.5rem;">
                <div class="admin-card__content" style="padding: 1rem 1.5rem;">
                    <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                        <button onclick="openModal()" class="btn btn--primary" style="padding: 0.5rem 1rem;">+ 채용공고 등록</button>
                        <span style="margin-left: auto; font-size: 0.875rem; color: var(--text-light);">총 <strong id="totalCount">0</strong>건</span>
                        <button onclick="loadCareers()" class="btn btn--outline" style="padding: 0.5rem 1rem;">새로고침</button>
                    </div>
                </div>
            </div>

            <div class="admin-card">
                <div class="admin-card__content" style="padding: 0;">
                    <table class="admin-table">
                        <thead><tr><th style="width: 80px;">상태</th><th>포지션</th><th style="width: 100px;">마감일</th><th style="width: 120px;">관리</th></tr></thead>
                        <tbody id="careersList"><tr><td colspan="4" style="text-align: center; padding: 3rem;">로딩 중...</td></tr></tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <div id="careerModal" class="admin-modal" style="display: none;">
        <div class="admin-modal__content" style="max-width: 800px;">
            <div class="admin-modal__header"><h3 id="modalTitle">채용공고 등록</h3><button class="admin-modal__close" onclick="closeModal()">&times;</button></div>
            <div class="admin-modal__body">
                <div style="margin-bottom: 1rem;"><label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">포지션명 *</label><input type="text" id="careerTitle" class="form-group__input" placeholder="예: 생산직 사원" required></div>
                <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                    <div style="flex: 1;"><label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">고용형태</label><select id="careerType" class="admin-select" style="width: 100%;"><option value="정규직">정규직</option><option value="계약직">계약직</option><option value="인턴">인턴</option><option value="파트타임">파트타임</option></select></div>
                    <div style="flex: 1;"><label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">상태</label><select id="careerStatus" class="admin-select" style="width: 100%;"><option value="채용중">채용중</option><option value="마감">마감</option></select></div>
                </div>
                <div style="margin-bottom: 1rem;"><label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">마감일</label><input type="date" id="careerDeadline" class="form-group__input"></div>
                <div style="margin-bottom: 1rem;"><label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">상세내용 *</label><div id="editor"></div></div>
            </div>
            <div class="admin-modal__footer"><button class="btn btn--primary" onclick="saveCareer()">저장</button><button class="btn btn--outline" onclick="closeModal()">취소</button></div>
        </div>
    </div>

    <style>
        .admin-select { padding: 0.5rem 1rem; border: 1px solid var(--border-light); border-radius: 0.375rem; font-size: 0.875rem; background: #fff; }
        .admin-modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000; padding: 1rem; }
        .admin-modal__content { background: #fff; border-radius: 0.75rem; width: 100%; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column; }
        .admin-modal__header { display: flex; justify-content: space-between; align-items: center; padding: 1.25rem 1.5rem; border-bottom: 1px solid var(--border-light); }
        .admin-modal__header h3 { font-size: 1.125rem; font-weight: 600; }
        .admin-modal__close { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-light); }
        .admin-modal__body { padding: 1.5rem; overflow-y: auto; flex: 1; }
        .admin-modal__footer { display: flex; gap: 0.75rem; padding: 1rem 1.5rem; border-top: 1px solid var(--border-light); justify-content: flex-end; }
        .admin-table tbody tr { transition: background 0.2s; }
        .admin-table tbody tr:hover { background: var(--bg-light); }
        .status-badge { display: inline-block; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 500; }
        .status-badge--open { background: #d1fae5; color: #065f46; }
        .status-badge--closed { background: #fee2e2; color: #991b1b; }
    </style>

    <script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc, query, orderBy, Timestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyCnMM7eMXjZgjP-dovTJ-cfH7iO5RWQnno", authDomain: "seopung-website.firebaseapp.com", projectId: "seopung-website", storageBucket: "seopung-website.firebasestorage.app", messagingSenderId: "563395096680", appId: "1:563395096680:web:8f363c42f6833f65628bdd" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let careersData = [], editId = null, editor = null;

        window.loadCareers = async function() {
            const tbody = document.getElementById('careersList');
            tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 2rem;">로딩 중...</td></tr>';
            try {
                const q = query(collection(db, "careers"), orderBy("createdAt", "desc"));
                const snap = await getDocs(q);
                careersData = []; snap.forEach(d => careersData.push({ id: d.id, ...d.data() }));
                document.getElementById('totalCount').textContent = careersData.length;
                if (careersData.length === 0) { tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 2rem; color: var(--text-light);">등록된 채용공고가 없습니다.</td></tr>'; return; }
                tbody.innerHTML = careersData.map(c => `<tr><td><span class="status-badge ${c.status === '채용중' ? 'status-badge--open' : 'status-badge--closed'}">${c.status || '채용중'}</span></td><td><strong>${c.title || '-'}</strong><br><small style="color: var(--text-light);">${c.type || '정규직'}</small></td><td>${c.deadline || '-'}</td><td><button class="btn btn--outline" style="padding: 0.25rem 0.5rem; font-size: 0.75rem; margin-right: 0.25rem;" onclick="editCareer('${c.id}')">수정</button><button class="btn btn--outline" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;" onclick="deleteCareer('${c.id}')">삭제</button></td></tr>`).join('');
            } catch (e) { console.error(e); tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 2rem; color: #ef4444;">로드 실패</td></tr>'; }
        };

        function initEditor() {
            if (editor) editor.destroy();
            editor = new toastui.Editor({ el: document.querySelector('#editor'), height: '300px', initialEditType: 'wysiwyg', previewStyle: 'vertical', language: 'ko-KR', placeholder: '채용 상세 내용을 입력하세요...', toolbarItems: [['heading', 'bold', 'italic'], ['ul', 'ol'], ['link']] });
        }

        window.openModal = function() { editId = null; document.getElementById('modalTitle').textContent = '채용공고 등록'; document.getElementById('careerTitle').value = ''; document.getElementById('careerType').value = '정규직'; document.getElementById('careerStatus').value = '채용중'; document.getElementById('careerDeadline').value = ''; document.getElementById('careerModal').style.display = 'flex'; setTimeout(() => { initEditor(); editor.setHTML(''); }, 100); };
        window.closeModal = function() { document.getElementById('careerModal').style.display = 'none'; };
        window.editCareer = function(id) { const c = careersData.find(x => x.id === id); if (!c) return; editId = id; document.getElementById('modalTitle').textContent = '채용공고 수정'; document.getElementById('careerTitle').value = c.title || ''; document.getElementById('careerType').value = c.type || '정규직'; document.getElementById('careerStatus').value = c.status || '채용중'; document.getElementById('careerDeadline').value = c.deadline || ''; document.getElementById('careerModal').style.display = 'flex'; setTimeout(() => { initEditor(); editor.setHTML(c.content || ''); }, 100); };
        window.saveCareer = async function() {
            const title = document.getElementById('careerTitle').value.trim(), type = document.getElementById('careerType').value, status = document.getElementById('careerStatus').value, deadline = document.getElementById('careerDeadline').value, content = editor ? editor.getHTML() : '';
            if (!title) { alert('포지션명을 입력해주세요.'); return; }
            try {
                if (editId) { await updateDoc(doc(db, "careers", editId), { title, type, status, deadline, content, updatedAt: Timestamp.now() }); alert('수정되었습니다.'); }
                else { await addDoc(collection(db, "careers"), { title, type, status, deadline, content, views: 0, createdAt: Timestamp.now() }); alert('등록되었습니다.'); }
                closeModal(); loadCareers();
            } catch (e) { console.error(e); alert('저장 실패'); }
        };
        window.deleteCareer = async function(id) { if (!confirm('삭제하시겠습니까?')) return; try { await deleteDoc(doc(db, "careers", id)); loadCareers(); } catch (e) { alert('삭제 실패'); } };

        const isLoggedIn = localStorage.getItem('adminLoggedIn') === 'true' || sessionStorage.getItem('adminLoggedIn') === 'true';
        if (!isLoggedIn) window.location.href = 'index.html';
        document.getElementById('currentUser').textContent = localStorage.getItem('adminUser') || sessionStorage.getItem('adminUser') || '관리자';
        window.logout = function() { localStorage.removeItem('adminLoggedIn'); localStorage.removeItem('adminUser'); localStorage.removeItem('loginTime'); sessionStorage.clear(); window.location.href = 'index.html'; };
        document.getElementById('careerModal').addEventListener('click', function(e) { if (e.target === this) closeModal(); });
        loadCareers();
    </script>
</body>
</html>
