<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì œí’ˆ ê´€ë¦¬ | ì„œí’ ê´€ë¦¬ì</title>
    <meta name="robots" content="noindex, nofollow">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/admin.css">
</head>
<body class="admin-page">
    <aside class="admin-sidebar">
        <div class="admin-sidebar__header"><img src="../logo_transparent.png" alt="ì„œí’" class="admin-sidebar__logo"><span>ì„œí’ ê´€ë¦¬ì</span></div>
        <nav class="admin-nav">
            <a href="dashboard.html" class="admin-nav__item"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg><span>ëŒ€ì‹œë³´ë“œ</span></a>
            <a href="products-manage.html" class="admin-nav__item admin-nav__item--active"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg><span>ì œí’ˆ ê´€ë¦¬</span></a>
            <a href="gallery-manage.html" class="admin-nav__item"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg><span>ê°¤ëŸ¬ë¦¬</span></a>
            <a href="notices.html" class="admin-nav__item"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 17H2a3 3 0 0 0 3-3V9a7 7 0 0 1 14 0v5a3 3 0 0 0 3 3zm-8.27 4a2 2 0 0 1-3.46 0"/></svg><span>ê³µì§€ì‚¬í•­</span></a>
            <a href="news-manage.html" class="admin-nav__item"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-2 2Zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2"/></svg><span>ë‰´ìŠ¤/ë³´ë„</span></a>
            <a href="resources-manage.html" class="admin-nav__item"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg><span>ìë£Œì‹¤</span></a>
            <a href="inquiries.html" class="admin-nav__item"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg><span>ë¬¸ì˜ ê´€ë¦¬</span></a>
        </nav>
        <div class="admin-sidebar__footer">
            <a href="../index.html" class="admin-sidebar__link"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg><span>ì‚¬ì´íŠ¸ ë³´ê¸°</span></a>
            <button class="admin-sidebar__logout" onclick="logout()"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg><span>ë¡œê·¸ì•„ì›ƒ</span></button>
        </div>
    </aside>

    <main class="admin-main">
        <header class="admin-header">
            <div class="admin-header__title"><h1>ì œí’ˆ ê´€ë¦¬</h1><p>ì œí’ˆ ì¹´íƒˆë¡œê·¸ë¥¼ ê´€ë¦¬í•˜ì„¸ìš”</p></div>
        </header>

        <div class="admin-content">
            <div class="admin-card" style="margin-bottom: 1.5rem;">
                <div class="admin-card__content" style="padding: 1rem 1.5rem;">
                    <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                        <button onclick="openModal()" class="btn btn--primary" style="padding: 0.5rem 1rem;">+ ì œí’ˆ ë“±ë¡</button>
                        <select id="categoryFilter" onchange="filterByCategory()" class="admin-select">
                            <option value="all">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
                            <option value="ê³ ë“±ì–´">ê³ ë“±ì–´</option>
                            <option value="ê°ˆì¹˜">ê°ˆì¹˜</option>
                            <option value="ì˜¤ì§•ì–´">ì˜¤ì§•ì–´</option>
                            <option value="ìƒˆìš°">ìƒˆìš°</option>
                            <option value="ì—°ì–´">ì—°ì–´</option>
                            <option value="ì°¸ë”">ì°¸ë”</option>
                            <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                        </select>
                        <span style="margin-left: auto; font-size: 0.875rem; color: var(--text-light);">ì´ <strong id="totalCount">0</strong>ê±´</span>
                        <button onclick="loadProducts()" class="btn btn--outline" style="padding: 0.5rem 1rem;">ìƒˆë¡œê³ ì¹¨</button>
                    </div>
                </div>
            </div>

            <div class="products-grid" id="productsGrid">
                <div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: var(--text-light);">ë¡œë”© ì¤‘...</div>
            </div>
        </div>
    </main>

    <!-- Product Modal -->
    <div id="productModal" class="admin-modal" style="display: none;">
        <div class="admin-modal__content" style="max-width: 700px;">
            <div class="admin-modal__header"><h3 id="modalTitle">ì œí’ˆ ë“±ë¡</h3><button class="admin-modal__close" onclick="closeModal()">&times;</button></div>
            <div class="admin-modal__body">
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">ì œí’ˆëª… *</label>
                    <input type="text" id="productName" class="form-group__input" placeholder="ì˜ˆ: ë…¸ë¥´ì›¨ì´ì‚° ê°„ê³ ë“±ì–´" required>
                </div>
                <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                    <div style="flex: 1;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">ì¹´í…Œê³ ë¦¬</label>
                        <select id="productCategory" class="admin-select" style="width: 100%;">
                            <option value="ê³ ë“±ì–´">ê³ ë“±ì–´</option>
                            <option value="ê°ˆì¹˜">ê°ˆì¹˜</option>
                            <option value="ì˜¤ì§•ì–´">ì˜¤ì§•ì–´</option>
                            <option value="ìƒˆìš°">ìƒˆìš°</option>
                            <option value="ì—°ì–´">ì—°ì–´</option>
                            <option value="ì°¸ë”">ì°¸ë”</option>
                            <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                        </select>
                    </div>
                    <div style="flex: 1;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">ì›ì‚°ì§€</label>
                        <input type="text" id="productOrigin" class="form-group__input" placeholder="ì˜ˆ: ë…¸ë¥´ì›¨ì´">
                    </div>
                </div>
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">ì´ë¯¸ì§€ URL</label>
                    <input type="url" id="productImage" class="form-group__input" placeholder="https://example.com/image.jpg">
                    <p style="font-size: 0.75rem; color: var(--text-light); margin-top: 0.25rem;">Unsplash ë“±ì—ì„œ ì´ë¯¸ì§€ URLì„ ë³µì‚¬í•˜ì„¸ìš”</p>
                </div>
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">ê·œê²©/í¬ì¥</label>
                    <input type="text" id="productSpec" class="form-group__input" placeholder="ì˜ˆ: 200g x 2íŒ© / ë°•ìŠ¤ë‹¹ 20íŒ©">
                </div>
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">ì œí’ˆ ì„¤ëª…</label>
                    <textarea id="productDesc" class="form-group__textarea" rows="4" placeholder="ì œí’ˆ íŠ¹ì§•ì„ ê°„ë‹¨íˆ ì„¤ëª…í•˜ì„¸ìš”"></textarea>
                </div>
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">ìˆœì„œ (ë‚®ì„ìˆ˜ë¡ ìƒë‹¨)</label>
                    <input type="number" id="productOrder" class="form-group__input" value="0" min="0" style="width: 100px;">
                </div>
            </div>
            <div class="admin-modal__footer">
                <button class="btn btn--primary" onclick="saveProduct()">ì €ì¥</button>
                <button class="btn btn--outline" onclick="closeModal()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <style>
        .admin-select { padding: 0.5rem 1rem; border: 1px solid var(--border-light); border-radius: 0.375rem; font-size: 0.875rem; background: #fff; }
        .admin-modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000; padding: 1rem; }
        .admin-modal__content { background: #fff; border-radius: 0.75rem; width: 100%; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column; }
        .admin-modal__header { display: flex; justify-content: space-between; align-items: center; padding: 1.25rem 1.5rem; border-bottom: 1px solid var(--border-light); }
        .admin-modal__header h3 { font-size: 1.125rem; font-weight: 600; }
        .admin-modal__close { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-light); }
        .admin-modal__body { padding: 1.5rem; overflow-y: auto; flex: 1; }
        .admin-modal__footer { display: flex; gap: 0.75rem; padding: 1rem 1.5rem; border-top: 1px solid var(--border-light); justify-content: flex-end; }
        .form-group__textarea { width: 100%; padding: 0.75rem 1rem; border: 1px solid var(--border-light); border-radius: 0.375rem; font-size: 0.9375rem; resize: vertical; font-family: inherit; }

        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem; }
        .product-card { background: #fff; border: 1px solid var(--border-light); border-radius: 0.75rem; overflow: hidden; transition: all 0.2s; }
        .product-card:hover { box-shadow: var(--shadow-md); }
        .product-card__image { height: 180px; background: var(--bg-light); overflow: hidden; }
        .product-card__image img { width: 100%; height: 100%; object-fit: cover; }
        .product-card__placeholder { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 3rem; color: var(--text-muted); }
        .product-card__body { padding: 1rem 1.25rem; }
        .product-card__category { display: inline-block; padding: 0.2rem 0.5rem; background: var(--primary); color: #fff; font-size: 0.7rem; border-radius: 0.25rem; margin-bottom: 0.5rem; }
        .product-card__name { font-size: 1rem; font-weight: 600; color: var(--text-dark); margin-bottom: 0.25rem; }
        .product-card__origin { font-size: 0.8rem; color: var(--text-light); margin-bottom: 0.5rem; }
        .product-card__actions { display: flex; gap: 0.5rem; padding-top: 0.75rem; border-top: 1px solid var(--border-light); }
        .product-card__actions button { flex: 1; padding: 0.4rem; font-size: 0.75rem; }
    </style>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc, query, orderBy, Timestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyCnMM7eMXjZgjP-dovTJ-cfH7iO5RWQnno", authDomain: "seopung-website.firebaseapp.com", projectId: "seopung-website", storageBucket: "seopung-website.firebasestorage.app", messagingSenderId: "563395096680", appId: "1:563395096680:web:8f363c42f6833f65628bdd" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let productsData = [], filteredData = [], editId = null;

        window.loadProducts = async function() {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 2rem;">ë¡œë”© ì¤‘...</div>';
            try {
                const q = query(collection(db, "products"), orderBy("order", "asc"));
                const snap = await getDocs(q);
                productsData = []; snap.forEach(d => productsData.push({ id: d.id, ...d.data() }));
                filteredData = [...productsData];
                document.getElementById('totalCount').textContent = productsData.length;
                renderProducts();
            } catch (e) { console.error(e); grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 2rem; color: #ef4444;">ë¡œë“œ ì‹¤íŒ¨</div>'; }
        };

        function renderProducts() {
            const grid = document.getElementById('productsGrid');
            if (filteredData.length === 0) { grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: var(--text-light);">ë“±ë¡ëœ ì œí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</div>'; return; }
            grid.innerHTML = filteredData.map(p => `
                <div class="product-card">
                    <div class="product-card__image">
                        ${p.image ? `<img src="${p.image}" alt="${p.name}">` : '<div class="product-card__placeholder">ğŸŸ</div>'}
                    </div>
                    <div class="product-card__body">
                        <span class="product-card__category">${p.category || 'ê¸°íƒ€'}</span>
                        <h4 class="product-card__name">${p.name || '(ì œí’ˆëª… ì—†ìŒ)'}</h4>
                        <p class="product-card__origin">${p.origin ? `ì›ì‚°ì§€: ${p.origin}` : ''} ${p.spec ? `| ${p.spec}` : ''}</p>
                        <div class="product-card__actions">
                            <button class="btn btn--outline" onclick="editProduct('${p.id}')">ìˆ˜ì •</button>
                            <button class="btn btn--outline" onclick="deleteProduct('${p.id}')">ì‚­ì œ</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        window.filterByCategory = function() {
            const cat = document.getElementById('categoryFilter').value;
            filteredData = cat === 'all' ? [...productsData] : productsData.filter(p => p.category === cat);
            renderProducts();
        };

        window.openModal = function() { editId = null; document.getElementById('modalTitle').textContent = 'ì œí’ˆ ë“±ë¡'; document.getElementById('productName').value = ''; document.getElementById('productCategory').value = 'ê³ ë“±ì–´'; document.getElementById('productOrigin').value = ''; document.getElementById('productImage').value = ''; document.getElementById('productSpec').value = ''; document.getElementById('productDesc').value = ''; document.getElementById('productOrder').value = '0'; document.getElementById('productModal').style.display = 'flex'; };
        window.closeModal = function() { document.getElementById('productModal').style.display = 'none'; };

        window.editProduct = function(id) {
            const p = productsData.find(x => x.id === id); if (!p) return;
            editId = id;
            document.getElementById('modalTitle').textContent = 'ì œí’ˆ ìˆ˜ì •';
            document.getElementById('productName').value = p.name || '';
            document.getElementById('productCategory').value = p.category || 'ê³ ë“±ì–´';
            document.getElementById('productOrigin').value = p.origin || '';
            document.getElementById('productImage').value = p.image || '';
            document.getElementById('productSpec').value = p.spec || '';
            document.getElementById('productDesc').value = p.description || '';
            document.getElementById('productOrder').value = p.order || 0;
            document.getElementById('productModal').style.display = 'flex';
        };

        window.saveProduct = async function() {
            const name = document.getElementById('productName').value.trim();
            const category = document.getElementById('productCategory').value;
            const origin = document.getElementById('productOrigin').value.trim();
            const image = document.getElementById('productImage').value.trim();
            const spec = document.getElementById('productSpec').value.trim();
            const description = document.getElementById('productDesc').value.trim();
            const order = parseInt(document.getElementById('productOrder').value) || 0;
            if (!name) { alert('ì œí’ˆëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
            try {
                if (editId) { await updateDoc(doc(db, "products", editId), { name, category, origin, image, spec, description, order, updatedAt: Timestamp.now() }); alert('ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.'); }
                else { await addDoc(collection(db, "products"), { name, category, origin, image, spec, description, order, createdAt: Timestamp.now() }); alert('ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.'); }
                closeModal(); loadProducts();
            } catch (e) { console.error(e); alert('ì €ì¥ ì‹¤íŒ¨'); }
        };

        window.deleteProduct = async function(id) { if (!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return; try { await deleteDoc(doc(db, "products", id)); loadProducts(); } catch (e) { alert('ì‚­ì œ ì‹¤íŒ¨'); } };

        const isLoggedIn = localStorage.getItem('adminLoggedIn') === 'true' || sessionStorage.getItem('adminLoggedIn') === 'true';
        if (!isLoggedIn) window.location.href = 'index.html';
        window.logout = function() { localStorage.removeItem('adminLoggedIn'); localStorage.removeItem('adminUser'); localStorage.removeItem('loginTime'); sessionStorage.clear(); window.location.href = 'index.html'; };
        document.getElementById('productModal').addEventListener('click', function(e) { if (e.target === this) closeModal(); });
        loadProducts();
    </script>
</body>
</html>
