<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>자료실 | 서풍</title>
    <meta name="description" content="서풍 자료실 - 제품 카탈로그, 인증서, 품질 성적서 다운로드">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/responsive.css">
    <link rel="stylesheet" href="../css/board.css">
</head>
<body>
    <!-- Header -->
    <header class="header" id="header">
        <div class="header__container">
            <a href="../index.html" class="logo">
                <div class="logo__icon">
                    <img src="../logo_transparent.png" alt="서풍 로고">
                </div>
                <div class="logo__text">
                    <span class="logo__main">서풍</span>
                    <span class="logo__sub">SEOPOONG</span>
                </div>
            </a>

            <nav class="nav">
                <ul class="nav__list" id="navList">
                    <li><a href="../index.html" class="nav__link">홈</a></li>
                    <li><a href="../about.html" class="nav__link">회사소개</a></li>
                    <li><a href="../process.html" class="nav__link">가공 프로세스</a></li>
                    <li><a href="../products.html" class="nav__link">제품</a></li>
                    <li><a href="../gallery.html" class="nav__link">갤러리</a></li>
                    <li><a href="../board.html" class="nav__link nav__link--active">게시판</a></li>
                    <li><a href="../contact.html" class="nav__link nav__link--cta">문의하기</a></li>
                </ul>
                <button class="nav__toggle" id="navToggle" aria-label="메뉴 열기">
                    <span class="nav__toggle-bar"></span>
                    <span class="nav__toggle-bar"></span>
                    <span class="nav__toggle-bar"></span>
                </button>
            </nav>
        </div>
    </header>

    <!-- Page Header -->
    <section class="page-header">
        <div class="page-header__content">
            <span class="page-header__tag">RESOURCES</span>
            <h1 class="page-header__title">자료실</h1>
            <p class="page-header__desc">제품 카탈로그, 인증서, 품질 성적서를 다운로드하세요</p>
        </div>
    </section>

    <!-- Resources Section -->
    <section class="section">
        <div class="container">
            <!-- Category Filter -->
            <div class="board-toolbar">
                <div class="board-filter">
                    <button class="board-filter__btn board-filter__btn--active" onclick="filterCategory('all')">전체</button>
                    <button class="board-filter__btn" onclick="filterCategory('카탈로그')">카탈로그</button>
                    <button class="board-filter__btn" onclick="filterCategory('인증서')">인증서</button>
                    <button class="board-filter__btn" onclick="filterCategory('품질성적서')">품질성적서</button>
                    <button class="board-filter__btn" onclick="filterCategory('회사소개서')">회사소개서</button>
                </div>
                <div class="board-search">
                    <input type="text" class="board-search__input" id="searchInput" placeholder="자료명 검색" onkeypress="if(event.key==='Enter') searchResources()">
                    <button class="board-search__btn" onclick="searchResources()">검색</button>
                </div>
            </div>

            <!-- Resources Grid -->
            <div class="resources-grid" id="resourcesGrid">
                <div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: var(--text-light);">
                    로딩 중...
                </div>
            </div>

            <!-- Notice -->
            <div style="margin-top: 2rem; padding: 1.25rem 1.5rem; background: var(--bg-light); border-radius: var(--radius-md); border-left: 4px solid var(--primary);">
                <p style="font-size: 0.9rem; color: var(--text-body); margin: 0;">
                    <strong>안내:</strong> 추가 자료가 필요하시면 <a href="inquiry.html" style="color: var(--primary);">제품 문의</a>를 통해 요청해 주세요.
                    학교급식용 품질성적서, 특정 제품 규격서 등 맞춤 자료를 제공해 드립니다.
                </p>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer__container">
            <div class="footer__grid">
                <div class="footer__brand">
                    <h3 class="footer__brand-title">서풍</h3>
                    <p class="footer__brand-desc">
                        신뢰로써 공존하는 기업<br>
                        50년 경력의 베테랑이 가진 '선별의 눈'과 최신 가공 시설로<br>
                        가장 신선하고 안전한 수산물을 공급합니다.
                    </p>
                </div>
                <div class="footer__links">
                    <h4 class="footer__title">바로가기</h4>
                    <ul>
                        <li><a href="../about.html">회사소개</a></li>
                        <li><a href="../process.html">가공 프로세스</a></li>
                        <li><a href="../products.html">제품</a></li>
                        <li><a href="../gallery.html">갤러리</a></li>
                    </ul>
                </div>
                <div class="footer__links">
                    <h4 class="footer__title">게시판</h4>
                    <ul>
                        <li><a href="notice.html">공지사항</a></li>
                        <li><a href="resources.html">자료실</a></li>
                        <li><a href="inquiry.html">제품 문의</a></li>
                        <li><a href="quote.html">견적 요청</a></li>
                    </ul>
                </div>
                <div class="footer__links">
                    <h4 class="footer__title">연락처</h4>
                    <ul>
                        <li><a href="tel:061-681-5171">061-681-5171</a></li>
                        <li>FAX 061-681-5173</li>
                        <li><a href="../contact.html">전남 여수시 화양면 석교로 121</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer__bottom">
                <p>&copy; 2024 영어조합법인 서풍. All rights reserved.</p>
                <p>사업자등록번호: 417-81-41979 | 대표: 서순심 | 평일 09:00 - 18:00 | <a href="../admin/" style="color: var(--text-muted);">관리자</a></p>
            </div>
        </div>
    </footer>

    <script src="../js/main.js"></script>
    <script src="../js/navigation.js"></script>

    <style>
        /* Resources Grid */
        .resources-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
        }

        .resource-card {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1.5rem;
            background: var(--bg-white);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            transition: all var(--transition-normal);
        }

        .resource-card:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
        }

        .resource-card__icon {
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-light);
            border-radius: var(--radius-md);
            color: var(--primary);
            flex-shrink: 0;
        }

        .resource-card__icon--cert { background: rgba(16, 185, 129, 0.1); color: #10b981; }
        .resource-card__icon--quality { background: rgba(139, 92, 246, 0.1); color: #8b5cf6; }
        .resource-card__icon--company { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }

        .resource-card__content { flex: 1; min-width: 0; }
        .resource-card__category {
            display: inline-block;
            padding: 0.1875rem 0.5rem;
            background: var(--primary);
            color: #fff;
            font-size: 0.6875rem;
            font-weight: 600;
            border-radius: var(--radius-sm);
            margin-bottom: 0.5rem;
        }
        .resource-card__category--cert { background: #10b981; }
        .resource-card__category--quality { background: #8b5cf6; }
        .resource-card__category--company { background: #f59e0b; }

        .resource-card__title {
            font-size: 0.9375rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .resource-card__desc { font-size: 0.8125rem; color: var(--text-light); margin-bottom: 0.75rem; }
        .resource-card__meta { display: flex; gap: 0.75rem; font-size: 0.75rem; color: var(--text-muted); }

        .resource-card__download {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--primary);
            color: #fff;
            border-radius: var(--radius-md);
            flex-shrink: 0;
            transition: background var(--transition-fast);
        }
        .resource-card__download:hover { background: var(--primary-dark); }

        @media (max-width: 1024px) { .resources-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 768px) {
            .resources-grid { grid-template-columns: 1fr; }
            .resource-card { flex-wrap: wrap; }
            .resource-card__download { margin-left: auto; }
        }
    </style>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, updateDoc, increment, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCnMM7eMXjZgjP-dovTJ-cfH7iO5RWQnno",
            authDomain: "seopung-website.firebaseapp.com",
            projectId: "seopung-website",
            storageBucket: "seopung-website.firebasestorage.app",
            messagingSenderId: "563395096680",
            appId: "1:563395096680:web:8f363c42f6833f65628bdd"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let resourcesData = [];
        let filteredData = [];
        let currentCategory = 'all';

        const categoryIconMap = {
            '카탈로그': '',
            '인증서': '--cert',
            '품질성적서': '--quality',
            '회사소개서': '--company'
        };

        const categoryClassMap = {
            '카탈로그': '',
            '인증서': '--cert',
            '품질성적서': '--quality',
            '회사소개서': '--company'
        };

        function formatDate(timestamp) {
            if (!timestamp) return '-';
            const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
            return `${date.getFullYear()}.${String(date.getMonth()+1).padStart(2,'0')}.${String(date.getDate()).padStart(2,'0')}`;
        }

        async function loadResources() {
            try {
                const q = query(collection(db, "resources"), orderBy("createdAt", "desc"));
                const querySnapshot = await getDocs(q);
                resourcesData = [];
                querySnapshot.forEach((doc) => {
                    resourcesData.push({ id: doc.id, ...doc.data() });
                });

                filteredData = [...resourcesData];
                renderResources();
            } catch (error) {
                console.error("Error loading resources:", error);
                document.getElementById('resourcesGrid').innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: var(--text-light);">
                        자료를 불러올 수 없습니다.
                    </div>
                `;
            }
        }

        function renderResources() {
            const container = document.getElementById('resourcesGrid');

            if (filteredData.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: var(--text-light);">
                        등록된 자료가 없습니다.
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredData.map(resource => {
                const iconClass = categoryIconMap[resource.category] || '';
                const categoryClass = categoryClassMap[resource.category] || '';

                return `
                    <div class="resource-card">
                        <div class="resource-card__icon resource-card__icon${iconClass}">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                            </svg>
                        </div>
                        <div class="resource-card__content">
                            <span class="resource-card__category resource-card__category${categoryClass}">${resource.category || '기타'}</span>
                            <h4 class="resource-card__title">${resource.title || '(제목 없음)'}</h4>
                            <p class="resource-card__desc">${resource.description || ''}</p>
                            <div class="resource-card__meta">
                                <span>${resource.format || 'PDF'}</span>
                                <span>${resource.size || '-'}</span>
                                <span>${formatDate(resource.createdAt)}</span>
                            </div>
                        </div>
                        <a href="${resource.url || '#'}" class="resource-card__download" title="다운로드" target="_blank" onclick="trackDownload('${resource.id}')">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="7 10 12 15 17 10"/>
                                <line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                        </a>
                    </div>
                `;
            }).join('');
        }

        window.filterCategory = function(category) {
            currentCategory = category;

            document.querySelectorAll('.board-filter__btn').forEach(btn => btn.classList.remove('board-filter__btn--active'));
            event.target.classList.add('board-filter__btn--active');

            if (category === 'all') {
                filteredData = [...resourcesData];
            } else {
                filteredData = resourcesData.filter(r => r.category === category);
            }
            renderResources();
        };

        window.searchResources = function() {
            const keyword = document.getElementById('searchInput').value.trim().toLowerCase();

            if (!keyword) {
                filteredData = currentCategory === 'all' ? [...resourcesData] : resourcesData.filter(r => r.category === currentCategory);
            } else {
                filteredData = resourcesData.filter(r => {
                    const matchCategory = currentCategory === 'all' || r.category === currentCategory;
                    const matchKeyword = (r.title && r.title.toLowerCase().includes(keyword)) ||
                                        (r.description && r.description.toLowerCase().includes(keyword));
                    return matchCategory && matchKeyword;
                });
            }
            renderResources();
        };

        window.trackDownload = async function(id) {
            try {
                await updateDoc(doc(db, "resources", id), { downloads: increment(1) });
            } catch (e) { console.error(e); }
        };

        // 초기 로드
        loadResources();
    </script>
</body>
</html>
